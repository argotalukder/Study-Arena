<!DOCTYPE html>
<html lang="en" class="dark">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>Group Info</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@300;400;500;600;700&display=swap" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&display=swap" rel="stylesheet"/>
    <script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#22C55E", 
                        "background-dark": "#121212",
                        "surface-dark": "#1E1E1E",
                        "input-bar": "#2A2A2A",
                    },
                    fontFamily: { "display": ["Lexend", "sans-serif"] },
                },
            },
        }
    </script>
    <style> body { font-family: 'Lexend', sans-serif; -webkit-tap-highlight-color: transparent; } 
    .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="bg-black text-white flex justify-center min-h-screen">
    <div class="w-full max-w-md bg-background-dark min-h-[100dvh] flex flex-col relative shadow-2xl border-x border-input-bar/30 overflow-hidden">
        
        <!-- Header -->
        <header class="flex items-center justify-between px-4 py-3 bg-surface-dark border-b border-input-bar z-20 sticky top-0">
            <button onclick="history.back()" class="flex items-center justify-center w-10 h-10 rounded-full hover:bg-input-bar transition-colors text-gray-300">
                <span class="material-symbols-outlined">arrow_back</span>
            </button>
            <h1 class="text-base font-bold text-white leading-tight">Group Info</h1>
            <button class="flex items-center justify-center w-10 h-10 rounded-full hover:bg-input-bar transition-colors text-gray-300">
                <span class="material-symbols-outlined">more_vert</span>
            </button>
        </header>

        <!-- Main Content -->
        <main class="flex-1 overflow-y-auto no-scrollbar bg-background-dark pb-24">
            
            <!-- Group Header Info -->
            <div class="flex flex-col items-center pt-8 pb-6 px-4">
                <div class="relative">
                    <div id="group-icon" class="w-24 h-24 rounded-full bg-input-bar bg-center bg-cover border-4 border-surface-dark shadow-lg mb-4 flex items-center justify-center text-primary">
                        <span class="material-symbols-outlined text-4xl">groups</span>
                    </div>
                    <div class="absolute bottom-4 right-0 w-6 h-6 bg-primary rounded-full border-2 border-background-dark flex items-center justify-center">
                        <span class="material-symbols-outlined text-white text-[14px]">check</span>
                    </div>
                </div>
                <h2 id="group-name" class="text-xl font-bold text-white mb-1 text-center">Loading...</h2>
                <p id="group-meta" class="text-sm text-gray-400">Loading details...</p>
                
                <div class="flex gap-4 mt-6 w-full justify-center">
                    <button class="flex flex-col items-center gap-1 group">
                        <div class="w-10 h-10 rounded-full bg-input-bar flex items-center justify-center text-primary group-active:scale-95 transition-transform">
                            <span class="material-symbols-outlined">notifications</span>
                        </div>
                        <span class="text-xs text-gray-400">Mute</span>
                    </button>
                    <button class="flex flex-col items-center gap-1 group">
                        <div class="w-10 h-10 rounded-full bg-input-bar flex items-center justify-center text-primary group-active:scale-95 transition-transform">
                            <span class="material-symbols-outlined">search</span>
                        </div>
                        <span class="text-xs text-gray-400">Search</span>
                    </button>
                    <button class="flex flex-col items-center gap-1 group">
                        <div class="w-10 h-10 rounded-full bg-input-bar flex items-center justify-center text-primary group-active:scale-95 transition-transform">
                            <span class="material-symbols-outlined">share</span>
                        </div>
                        <span class="text-xs text-gray-400">Share</span>
                    </button>
                </div>
            </div>

            <div class="h-2 bg-surface-dark/50 border-y border-input-bar"></div>

            <!-- About Section -->
            <div class="px-5 py-5">
                <h3 class="text-sm font-semibold text-gray-300 mb-2 uppercase tracking-wide">About Group</h3>
                <p id="group-desc" class="text-sm text-gray-400 leading-relaxed">No description provided.</p>
            </div>

            <div class="h-px bg-input-bar mx-5"></div>

            <!-- Media Section (Dummy for now, can be real later) -->
            <div class="px-5 py-5">
                <div class="flex items-center justify-between mb-3">
                    <h3 class="text-sm font-semibold text-gray-300 uppercase tracking-wide">Shared Media</h3>
                    <button class="text-xs text-primary font-medium hover:underline">See All</button>
                </div>
                <div class="grid grid-cols-4 gap-2">
                    <div class="aspect-square bg-input-bar rounded-lg flex items-center justify-center text-gray-600"><span class="material-symbols-outlined">image</span></div>
                    <div class="aspect-square bg-input-bar rounded-lg flex items-center justify-center text-gray-600"><span class="material-symbols-outlined">image</span></div>
                    <div class="aspect-square bg-input-bar rounded-lg flex items-center justify-center text-gray-600"><span class="material-symbols-outlined">description</span></div>
                    <div class="aspect-square bg-input-bar rounded-lg flex items-center justify-center text-gray-500 font-bold text-xs">+0</div>
                </div>
            </div>

            <div class="h-2 bg-surface-dark/50 border-y border-input-bar"></div>

            <!-- Members List -->
            <div class="px-0 py-2">
                <div class="px-5 py-3 flex items-center justify-between">
                    <h3 id="member-header" class="text-sm font-semibold text-gray-300 uppercase tracking-wide">Members</h3>
                    <span class="material-symbols-outlined text-gray-500 cursor-pointer">search</span>
                </div>
                
                <div id="members-list" class="flex flex-col">
                    <!-- Members will be injected here -->
                    <div class="flex justify-center py-4"><div class="w-6 h-6 border-2 border-primary border-t-transparent rounded-full animate-spin"></div></div>
                </div>
            </div>

            <div class="h-2 bg-surface-dark/50 border-y border-input-bar"></div>

            <!-- Exit Actions -->
            <div class="px-0 py-2 pb-8">
                <button class="w-full flex items-center px-5 py-3.5 hover:bg-input-bar transition-colors gap-3 group">
                    <span class="material-symbols-outlined text-gray-400 group-hover:text-primary transition-colors">settings</span>
                    <span class="text-sm text-white font-medium flex-1 text-left">Group Settings</span>
                    <span class="material-symbols-outlined text-gray-600 text-sm">arrow_forward_ios</span>
                </button>
                <button id="leave-btn" class="w-full flex items-center px-5 py-3.5 hover:bg-input-bar transition-colors gap-3 group">
                    <span class="material-symbols-outlined text-red-500 transition-colors">logout</span>
                    <span class="text-sm text-red-500 font-medium flex-1 text-left">Leave Group</span>
                </button>
            </div>
        </main>

        <!-- Floating Invite Button -->
        <div class="absolute bottom-[72px] left-0 w-full px-4 pb-4 bg-gradient-to-t from-background-dark to-transparent pointer-events-none flex justify-center">
            <button class="pointer-events-auto bg-primary hover:bg-primary-dark text-white font-medium rounded-xl py-3 px-6 w-full shadow-lg shadow-primary/20 transition-all active:scale-95 flex items-center justify-center gap-2">
                <span class="material-symbols-outlined">person_add</span>
                Invite Members
            </button>
        </div>

        <!-- Bottom Navigation -->
        <nav class="absolute bottom-0 left-0 right-0 bg-surface-dark border-t border-input-bar pb-6 pt-2 px-6 flex justify-between items-end z-40 h-[68px]">
            <a class="flex flex-col items-center justify-end gap-1 text-gray-400 group hover:text-gray-200 transition-colors h-full pb-2" href="/dashboard">
                <span class="material-symbols-outlined text-[24px] group-active:scale-90 transition-transform">home</span>
                <p class="text-[10px] font-medium leading-none">Home</p>
            </a>
            <a class="flex flex-col items-center justify-end gap-1 text-gray-400 group hover:text-gray-200 transition-colors h-full pb-2" href="#">
                <span class="material-symbols-outlined text-[24px] group-active:scale-90 transition-transform">calendar_month</span>
                <p class="text-[10px] font-medium leading-none">Calendar</p>
            </a>
            <a class="flex flex-col items-center justify-end gap-1 text-primary group h-full pb-2 relative" href="/groups">
                <span class="material-symbols-outlined text-[24px] font-variation-settings-fill group-active:scale-90 transition-transform">groups</span>
                <p class="text-[10px] font-medium leading-none">Groups</p>
            </a>
            <a class="flex flex-col items-center justify-end gap-1 text-gray-400 group hover:text-gray-200 transition-colors h-full pb-2" href="#">
                <span class="material-symbols-outlined text-[24px] group-active:scale-90 transition-transform">smart_toy</span>
                <p class="text-[10px] font-medium leading-none">AI</p>
            </a>
            <a class="flex flex-col items-center justify-end gap-1 text-gray-400 group hover:text-gray-200 transition-colors h-full pb-2" href="/profile">
                <span class="material-symbols-outlined text-[24px] group-active:scale-90 transition-transform">person</span>
                <p class="text-[10px] font-medium leading-none">Profile</p>
            </a>
        </nav>
    </div>

    <!-- Firebase Script -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
        import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, updateDoc, arrayRemove, increment } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDofDHfJvIKQmTtlg7x99mBtimuMmUUhBY",
            authDomain: "facebook-379b3.firebaseapp.com",
            projectId: "facebook-379b3",
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const urlParams = new URLSearchParams(window.location.search);
        const groupId = urlParams.get('id');
        let currentUser = null;

        onAuthStateChanged(auth, (user) => {
            if (user) { 
                currentUser = user;
                loadGroupData();
            } else { 
                window.location.href = "/auth"; 
            }
        });

        async function loadGroupData() {
            if(!groupId) return;
            const groupRef = doc(db, "groups", groupId);
            const groupSnap = await getDoc(groupRef);

            if(groupSnap.exists()) {
                const data = groupSnap.data();
                
                // Set Basic Info
                document.getElementById("group-name").innerText = data.name;
                document.getElementById("group-desc").innerText = data.description || "No description.";
                document.getElementById("group-meta").innerText = `${data.memberCount || 1} Members â€¢ Created by ${data.creatorName || 'Admin'}`;
                document.getElementById("member-header").innerText = `${data.memberCount || 1} Members`;

                // Set Avatar
                if(data.groupIcon) {
                    const iconEl = document.getElementById("group-icon");
                    iconEl.style.backgroundImage = `url('${data.groupIcon}')`;
                    iconEl.innerHTML = ''; // remove default icon
                }

                // Fetch & Render Members (Only creator + current user for demo, real implementation needs subcollection or array fetch)
                // Since members array holds UIDs, we would ideally fetch user profiles. 
                // For now, let's just show the creator and a placeholder for current user.
                
                const membersList = document.getElementById("members-list");
                membersList.innerHTML = ''; // Clear loader

                // Render Creator (Admin)
                const creatorHTML = `
                    <div class="flex items-center px-5 py-3 hover:bg-input-bar transition-colors cursor-pointer gap-3">
                        <div class="relative">
                            <div class="w-10 h-10 rounded-full bg-surface-dark bg-cover bg-center border border-gray-700" style="background-image: url('https://ui-avatars.com/api/?name=${data.creatorName}&background=random')"></div>
                            <div class="absolute bottom-0 right-0 w-2.5 h-2.5 bg-primary rounded-full border border-background-dark"></div>
                        </div>
                        <div class="flex-1">
                            <div class="flex justify-between items-center">
                                <h4 class="text-sm font-medium text-white">${data.creatorName}</h4>
                                <span class="text-[10px] font-bold text-primary bg-primary/10 px-2 py-0.5 rounded-full border border-primary/20">Admin</span>
                            </div>
                            <p class="text-xs text-gray-400">Group Creator</p>
                        </div>
                    </div>
                `;
                membersList.insertAdjacentHTML('beforeend', creatorHTML);

                // Render Current User (You)
                if(currentUser.uid !== data.createdBy) {
                    const youHTML = `
                        <div class="flex items-center px-5 py-3 hover:bg-input-bar transition-colors cursor-pointer gap-3">
                            <div class="relative">
                                <div class="w-10 h-10 rounded-full bg-surface-dark bg-cover bg-center border border-gray-700" style="background-image: url('${currentUser.photoURL || `https://ui-avatars.com/api/?name=User&background=random`}')"></div>
                                <div class="absolute bottom-0 right-0 w-2.5 h-2.5 bg-primary rounded-full border border-background-dark"></div>
                            </div>
                            <div class="flex-1">
                                <div class="flex justify-between items-center">
                                    <h4 class="text-sm font-medium text-white">You</h4>
                                </div>
                                <p class="text-xs text-gray-400">Online</p>
                            </div>
                        </div>
                    `;
                    membersList.insertAdjacentHTML('beforeend', youHTML);
                }
            }
        }

        // Leave Group Functionality
        document.getElementById("leave-btn").addEventListener("click", async () => {
            if(confirm("Are you sure you want to leave this group?")) {
                try {
                    await updateDoc(doc(db, "groups", groupId), {
                        members: arrayRemove(currentUser.uid),
                        memberCount: increment(-1)
                    });
                    window.location.href = "/groups";
                } catch(e) {
                    console.error("Error leaving group:", e);
                    alert("Failed to leave group.");
                }
            }
        });

    </script>
</body>
</html>